<!DOCTYPE html>
<html lang="en">
    <head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
    <meta charset="UTF-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title> HTB - Baby RE ‚Äî   | Gabriele Pongelli</title>
<meta name="description" content="This is the blog of Gabriele Pongelli.">
<meta name="keywords" content="">
<link rel="canonical" href="/posts/writeups/reverse%20engineering/htb-baby-re">
    <link rel="stylesheet" href="/assets/css/github-markdown.css" type="text/css">
<link rel="stylesheet" href="/assets/css/github.css" type="text/css">
<link rel="stylesheet" href="/assets/css/main.css">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/normalize/8.0.1/normalize.min.css" integrity="sha512-NhSC1YmyruXifcj/KFRWoC561YpHpc5Jtzgvbuzx5VozKpWvQ+4nXhPdFgmx8xqexRcpAglTj9sIBWINXa8x5w==" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.3/css/all.min.css" integrity="sha512-iBBXm8fW90+nuLcSKlbmrPcLa0OT92xO1BIsZ+ywDWZCvqsWgccV3gFoRBv0z+8dLJgyAHIhR35VZc2oM/gI1w==" crossorigin="anonymous">
<link href="https://fonts.googleapis.com/css?family=Quicksand" rel="stylesheet">
    </head>
    <body>
        <div class="wrapper">
        <header class="header">
    <div class="navigation">
        <a href="/" class="logo">Gabriele Pongelli</a>
        <ul class="menu">
            
            
            <li class="menu__entry"><a href="/">Home</a></li>
            
            <li class="menu__entry"><a href="/posts">Posts</a></li>
            
            <li class="menu__entry"><a href="/projects">Projects</a></li>
            
            <li class="menu__entry"><a href="/about">About</a></li>
            
        </ul>
    </div>
    <ul class="social-links">
    
    <a href="mailto:pongelligabriele@gmail.com" class="social-links__entry" target="_blank">
    <em class="fa fa-envelope-square"></em>
    </a>
    
    
    <a href="https://github.com/gabrielepongelli" class="social-links__entry" target="_blank">
    <em class="fab fa-github"></em>
    </a>
    
    
    <a href="https://in.linkedin.com/in/gabriele-p-68027a166" class="social-links__entry" target="_blank">
    <em class="fab fa-linkedin"></em>
    </a>
    
    </ul>
</header>
        <h1 class="page-title">
<div class="page-title__text">HTB - Baby RE</div>
<div class="page-title__subtitle"></div>
</h1>

<div class="entry-content markdown-body">
<p>
    <strong class="post-meta">
        <time class="dt-published" datetime="2021-03-22T00:00:00+00:00" itemprop="datePublished">Mar 22, 2021
        </time></strong>
</p>

<div class="post-content e-content" itemprop="articleBody">
    <p id="fail" style="display: none;"> The flag is not correct, but don't worry I'll try my best anyway üí™üèª. Et voil√†: </p>
    <div id="secure-container" style="display: none;">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
ktCMwjk=</div>

    <div id="flag-input-box" style="display: block;">
        This writeup is protected. Please insert the flag to view this content.<br><br>
        <input id="flag" type="text" value="">
        <button id="decrypt-btn" onclick="tryDecryptPost()">Decrypt</button>
        <br><br><br>
    </div>
</div>
<a class="u-url" href="/posts/writeups/reverse%20engineering/htb-baby-re" hidden></a>
<div id="decrypt_params">
<script>
let ivs = [];
ivs[0] = 'xLFttsBU4qzY7ZDQPuJKDA==';
</script>
</div>
<script>
    let base64ToBytes = (b64) => {
        const binString = atob(b64);
        return Uint8Array.from(binString, (m) => m.codePointAt(0));
    }

    let deriveKey = async (flag) => {
        const flagBytes = new TextEncoder().encode(flag);
        return await window.crypto.subtle.digest("SHA-256", flagBytes);
    }

    let decrypt = async (rawKey, iv, data) => {
        const key = await window.crypto.subtle.importKey("raw", rawKey,
            "AES-CBC", false, ["decrypt",]);
        return await window.crypto.subtle.decrypt({ name: "AES-CBC", iv }, key, data);
    }

    let showPageContent = (content, fail = false) => {
        let secureContainerNode = document.getElementById("secure-container");
        secureContainerNode.innerHTML = content;
        secureContainerNode.style.display = "block";

        let flagInputBoxNode = document.getElementById("flag-input-box");
        flagInputBoxNode.style.display = "none";

        if (fail) {
            const failMsgNode = document.getElementById("fail");
            failMsgNode.style.display = "block";
        }
    }

    let showCorrectFlagContent = async (post, key) => {
        let postHTML = new DOMParser().parseFromString(post, "text/html").body;

        for (const [idx, iv] of ivs.slice(1).entries()) {
            const imageId = `secure-image-${idx}`;
            let imageTag = postHTML.querySelectorAll("#" + imageId)[0];
            try {
                const response = await fetch(imageTag.src);
                const encryptedImage = await response.arrayBuffer();
                const decryptedBytes = await decrypt(key, base64ToBytes(iv), encryptedImage);
                const objectURL = URL.createObjectURL(new Blob(
                    [decryptedBytes], { type: 'image/png' }));
                imageTag.src = objectURL;
            } catch (error) {
                console.error("An error occurred while decrypting the images inside this post: ", error);
            }
        }

        showPageContent(postHTML.innerHTML);
    }

    let showError = (post) => {
        showPageContent(JSON.stringify(post), true);
    }

    let modifyPageContent = async (flag) => {
        const encryptedPost = base64ToBytes(document
            .getElementById("secure-container").innerHTML);
        const iv = base64ToBytes(ivs[0]);
        const key = await deriveKey(flag);
        try {
            const decryptedBytes = await decrypt(key, iv, encryptedPost);
            const decryptedPost = new TextDecoder().decode(decryptedBytes);

            showCorrectFlagContent(decryptedPost, key);
        } catch (err) {
            showError(new TextDecoder().decode(encryptedPost));
        }
    }

    let tryDecryptPost = () => {
        const flag = document.getElementById("flag").value;
        modifyPageContent(flag);
    }
</script>
</div>
        </div>
        <footer class="about">
    <div class="about__devider">*****</div>
    <div class="about__text">
        üõ†Ô∏è Powered by Jekyll üõ†Ô∏è
        <br> üìñ Hosted on GitHub Pages üìñ
    </div>
</footer>
    </body>
</html>
